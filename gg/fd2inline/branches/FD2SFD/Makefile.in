
VERSION		= @VERSION@
DATE		= @DATE@

srcdir		= @srcdir@

prefix		= @prefix@
exec_prefix	= @exec_prefix@
bindir		= @bindir@
datadir		= @datadir@
fd2sfddir	= ${datadir}/fd2sfd

CC		= @CC@
CPPFLAGS	= @CPPFLAGS@ -DVERSION=\"$(VERSION)\" -DDATE=\"$(DATE)\" \
		  -W -Wall
LDFLAGS		= @LDFLAGS@ -s

INSTALL		= @INSTALL@
INSTALL_PROGRAM	= @INSTALL_PROGRAM@ -s
INSTALL_DATA	= @INSTALL_DATA@

VPATH		= $(srcdir)

EXECUTABLE	= fd2sfd

all:		$(EXECUTABLE)

clean:
	$(RM) $(EXECUTABLE) $(EXECUTABLE)-$(VERSION).tar.gz $(EXECUTABLE).lha \
	      $(EXECUTABLE).readme *~ core config.log

distclean:	clean
	$(RM) Makefile cross/bin/gg-fix-includes config.status

maintainter-clean: distclean
	$(RM) $(srcdir)/configure gg-fd2sfd.spec

install:	all
	$(INSTALL) -d $(bindir) $(fd2sfddir)

	# Install tools
	$(INSTALL_PROGRAM) $(EXECUTABLE) $(bindir)
	$(INSTALL_PROGRAM) cross/bin/gg-fix-includes $(bindir)
	for f in `cd $(srcdir)/cross/share/ && find * -type f`; do \
	  $(INSTALL_DATA) -D $(srcdir)/cross/share/$${f} $(fd2sfddir)/$${f}; \
	done

	# Install example file structure for fds
	$(INSTALL) -d $(prefix)/os-lib/fd/3rd
	$(INSTALL) -d $(prefix)/os-lib/fd/amigaos
	$(INSTALL) -d $(prefix)/os-lib/fd/morphos
	$(INSTALL_DATA) $(srcdir)/README.os-lib $(prefix)/os-lib/fd/README

	# Install example file structure for includes
	$(INSTALL) -d $(prefix)/os-include/3rd
	for dir in classes clib datatypes devices diskfont dos exec \
		   gadgets graphics hardware images intuition libraries \
		   pragma pragmas prefs proto reaction resources rexx \
		   utility workbench; do \
	  $(INSTALL) -d $(prefix)/os-include/amigaos/$${dir}; \
	done
	for dir in clib cybergraphics cybergraphx datatypes devices \
		   emul exec powerup ppcdisslib resources; do \
	  $(INSTALL) -d $(prefix)/os-include/morphos/$${dir}; \
	done
	$(INSTALL_DATA) $(srcdir)/README.os-include $(prefix)/os-include/README

tgz:		all
	mv config.status .config.status
	make distclean
	mkdir .$(EXECUTABLE)-$(VERSION)
	cp -a * $(srcdir)/* .$(EXECUTABLE)-$(VERSION)
#	$(RM) -r .$(EXECUTABLE)-$(VERSION)/CVS
	mv .$(EXECUTABLE)-$(VERSION) $(EXECUTABLE)-$(VERSION)
	tar cfvz $(EXECUTABLE)-$(VERSION).tar.gz \
		`find $(EXECUTABLE)-$(VERSION) -type f -not -path "*CVS*"`
	$(RM) -r $(EXECUTABLE)-$(VERSION)
	mv .config.status config.status
	./config.status

lha:		tgz
	make all
	$(RM) $(EXECUTABLE).lha
	lha -ao5 $(EXECUTABLE).lha $(EXECUTABLE) $(EXECUTABLE).readme \
		 $(EXECUTABLE)-$(VERSION).tar.gz


$(EXECUTABLE):	fd2inline.c
	$(CC) $(CPPFLAGS) $(CFLAGS) $(LDFLAGS) $^ $(OUTPUT_OPTION)


