#!/bin/bash
#
# arp2-config: Simple configuration tool
#

prefix=@prefix@
exec_prefix=@exec_prefix@
bindir=@bindir@
sbindir=@sbindir@
sysconfdir=@sysconfdir@

export PATH=/sbin:/bin:/usr/X11R6/bin:${bindir}

# Import current configuration
. ${sysconfdir}/arp2.conf

while [ "${REPLY}" != "q" ]; do

    case "${REPLY}" in
	"ra") 
	    RESOLUTION=
	    ;;
	"d16") 
	    DEPTH=16
	    ;;
	"d24") 
	    DEPTH=24
	    ;;
	1.0|1.1|1.2|1.2|1.3|2.0|3.0|3.1)
	    KICKSTART=${REPLY}
	    ;;
	*)
	    echo ${REPLY} | egrep -q '^[0-9]{3,}x[0-9]{3,}' && RESOLUTION=${REPLY}
	    ;;
    esac

    # Clear screen, goto 0,0
    echo -en '\e[2J\e[0;0f'

    echo "Current configuration:"
#    echo "Font:          ${FONT}"
    echo "Resolution:    ${RESOLUTION:-Probed}"
    echo "Depth:         ${DEPTH:-24}"
    echo "Kickstart:     ${KICKSTART}"
    echo
    echo "Display Depth   Resolution       Kickstart version"
    echo "d16) HiColor    ra)      Auto    1.0) Kickstart 1.0"
    echo "d24) TrueColor  NNNxNNN) Custom  1.1) Kickstart 1.1"
    echo "                                 1.2) Kickstart 1.2"
    echo "                                 1.3) Kickstart 1.3"
    echo "                                 2.0) Kickstart 2.0"
    echo "                                 3.0) Kickstart 3.0"
    echo "q)  Quit                         3.1) Kickstart 3.1"

    echo -n "1> "
    read
done

# Write configuration
cat > ${sysconfdir}/arp2.conf <<EOF
FONT=${FONT:-topaz8dbl.psf}
KICKSTART=${KICKSTART}
RESOLUTION=${RESOLUTION}
DEPTH=${DEPTH:-24}

ISSUE=issue-${KICKSTART}
EOF
